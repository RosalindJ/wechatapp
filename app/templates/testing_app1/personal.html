<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>个人</title>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='app/css/base.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='app/css/sm.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='app/css/personal.css') }}">
</head>
<body>
	<div class="page-group">
        <div class="page page-current">
         	<div class="content">
         	<!-- 个人列表 -->
         		<div class="list-block">
				    <ul>
				    	<!-- 头像 -->
				      	<li class="item-content">
					        <div class="item-inner">
					          	<div class="item-title headWord">头像</div>
					          	<div class="item-media headImg">
					          		<img src="{{ url_for("static",filename="app/img/head.png") }}">
					          	</div>
					        </div>
					    </li>
							<!-- 昵称 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">昵称</div>
				          		<div class="item-after nickname"><!-- 李大健 --></div>
				        	</div>
				      	</li>
				      	<!-- 设备 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">设备</div>
				          		<div class="item-after machineN"><!-- 0台 --></div>
				        	</div>
				      	</li>
				      	<!-- 电话 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">电话</div>
				          		<div class="item-after telphone">
				          			<input type="tel" class="inputTel" placeholder="请输入电话">
				          		</div>
				        	</div>
				      	</li>
				      	<!-- 地址 -->
				      	<li class="item-content noBottom">
				        	<div class="item-inner">
				          		<div class="item-title">地址</div>
				          		<div class="item-after address">
				          			<div class="dizhi">
				          				<!-- <input type="text" id='city-picker' class="city" value="广东 广州 天河区" />
				          				<input type="text" class="fullAddress" value="林和西路耀中广场B座910"> -->
				          			</div>
				          		</div>
				        	</div>
				     	</li>
				    </ul>
				</div>
				<!-- 添加设备按钮 -->
				<div id="sheBtn" class="row fixed_foort">
					<a href="javascript:void(0);" class="col-66 button button-fill addBtn">保存</a>
				</div>
         	</div>
     	</div>
    </div>
	<script src="{{ url_for('static',filename="app/js/zepto.js") }}"></script>
	<script src="{{ url_for('static',filename="app/js/sm.js") }}"></script>
	<script src="http://g.alicdn.com/msui/sm/0.6.2/js/sm-city-picker.min.js" charset="UTF-8"></script>
	<script>
		(function(){
			// 请求数据
			var json_data;//json对象
			var strTel = null,telFirst,telLast;//电话号码，号码的前三位，号码的后四位
			$.ajax({
				type: "POST",
				url:"/getPersonal",
				success:function(data){
					// js对象转化成json对象
					console.log(data)
					json_data = JSON.parse(data);
					console.log(json_data)
					// 头像的图片
					$(".headImg img").eq(0).attr("src",json_data.headUrl)
					// var createImg = $('<img src="'+json_data.headUrl+'">');
					// $(".headImg").append(createImg);
					// 昵称
					$(".nickname").html(json_data.nickName);
					// 设备数量
					$(".machineN").html(json_data.machine + "台");
					// 电话号码
					if(json_data.yourTel){
						strTel = json_data.yourTel;
						telFirst = strTel.slice(0,3);//号码的前三位
						telLast = strTel.slice(7,11);//号码的最后四位
						// console.log($(this).val() + "  1-3 " + telFirst + "  7-11 " + telLast);
						$(".inputTel").val(telFirst + "****" + telLast)
					}
					// 地址
					var creatAddress = $('<input type="text" id="city-picker" class="city" value="'+json_data.addressCity+'" /><input type="text" class="fullAddress" value="'+json_data.fullAddress+'">');
					$(".dizhi").html(creatAddress);
					
				}
			})
			// 省市区
			$("#city-picker").cityPicker({
			    toolbarTemplate: '<header class="bar bar-nav">\
			    <button class="button button-link pull-right close-picker">确定</button>\
			    <h1 class="title">选择地址</h1>\
			    </header>'
			});

			// 电话
			// 电话号码的正则
			var regTel = /^[1][358][0-9]{9}$/;

			// 输入号码失去焦点
			$(".inputTel").blur(function(){
				if(regTel.test($(this).val().trim())){
					// strTel = $(this).val();
					// telFirst = strTel.slice(0,3);//号码的前三位
					// telLast = strTel.slice(7,11);//号码的最后四位
					// // console.log($(this).val() + "  1-3 " + telFirst + "  7-11 " + telLast);
					// $(this).val(telFirst + "****" + telLast)
					$(".telphone").parents(".item-content").removeClass('telActive');
				}else if($(this).val() == ""){
					$(".telphone").parents(".item-content").removeClass('telActive');
				}else{
					$(this).focus();
				}
			});
			// 输入号码聚焦
			$(".inputTel").focus(function(){
				$(".telphone").parents(".item-content").addClass('telActive');
				if(strTel){
					if(regTel.test(strTel)){
						$(this).val(strTel);
					}else{
						strTel = $(this).val();
					}
					
				}else{
					console.log("strTel = null")
				}
				// if($(this).val()){
				// 	if(regTel.test(strTel)){//当strTel有正确的手机号码值时
				// 		$(this).val(strTel);
				// 	}
				// }else{
				// 	strTel = $(this).val();
				// }
				// console.log($(this).val()+"sdf" + strTel)
				// $(".telphone").parents(".item-content").addClass('telActive');
				// if(regTel.test($(this).val().trim())){
				// 	if($(this).val()){
				// 		$(this).val(strTel);
				// 	}
				// }
				
			})
			// $(".inputTel").focus(function(){
			// 	$(".telphone").parents(".item-content").addClass('telActive');
			// 	if(regTel.test($(this).val().trim())){
					
			// 		if($(this).val()){
			// 			$(this).val(strTel);
			// 		}
			// 	}
				
			// });
			
			// 保存按钮
			// window.addEventLinstener("input",function(){
			// 	if($(".input").val())
			// },false)
			// if(){//页面修改了，就出现保存按钮

			// }
		})();
	</script>
</body>
</html>