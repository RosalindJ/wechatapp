<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>个人</title>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='app/css/base.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='app/css/sm.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='app/css/personal.css') }}">
</head>
<body>
	<div class="page-group">
        <div class="page page-current">
         	<div class="content">
         	<!-- 个人列表 -->
         		<div class="list-block">
				    <ul>
				    	<!-- 头像 -->
				      	<li class="item-content">
					        <div class="item-inner">
					          	<div class="item-title headWord">头像</div>
					          	<div class="item-media headImg">
					          		<img src="{{ url_for("static",filename=perInfor1.headUrl) }}">
					          	</div>
					        </div>
					    </li>
							<!-- 昵称 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">昵称</div>
				          		<div class="item-after nickname">{{ perInfor1.nickName }}<!-- 李大健 --></div>
				        	</div>
				      	</li>
				      	<!-- 设备 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">设备</div>
				          		<div class="item-after machineN">{{ perInfor1.machine }}台<!-- 0台 --></div>
				        	</div>
				      	</li>
				      	<!-- 电话 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">电话</div>
				          		<div class="item-after telphone1">
				          		</div>
				        	</div>
				      	</li>
				      	<!-- 地址 -->
				      	<li class="item-content noBottom">
				        	<div class="item-inner">
				          		<div class="item-title">地址</div>
				          		<div class="item-after address1">
				          			<div class="dizhi">
				          				<p>{{ perInfor1.addressCity }}</p>
				          				<p>{{ perInfor1.fullAddress }}</p>
				          			</div>
				          		</div>
				        	</div>
				     	</li>
				    </ul>
				</div>
         	</div>
     	</div>
     	<div class="page">
         	<div class="content">
         	<!-- 个人列表 -->
         		<div class="list-block">
				    <ul>
				    	<!-- 头像 -->
				      	<li class="item-content">
					        <div class="item-inner">
					          	<div class="item-title headWord">头像</div>
					          	<div class="item-media headImg">
					          		<img src="{{ url_for("static",filename=perInfor1.headUrl) }}">
					          	</div>
					        </div>
					    </li>
							<!-- 昵称 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">昵称</div>
				          		<div class="item-after nickname">{{ perInfor1.nickName }}<!-- 李大健 --></div>
				        	</div>
				      	</li>
				      	<!-- 设备 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">设备</div>
				          		<div class="item-after machineN">{{ perInfor1.machine }}台<!-- 0台 --></div>
				        	</div>
				      	</li>
				      	<!-- 电话 -->
				      	<li class="item-content">
				        	<div class="item-inner">
				          		<div class="item-title">电话</div>
				          		<div class="item-after telphone2">
				          			<input type="tel" class="inputTel" placeholder="请输入电话">
				          		</div>
				        	</div>
				      	</li>
				      	<!-- 地址 -->
				      	<li class="item-content noBottom">
				        	<div class="item-inner">
				          		<div class="item-title">地址</div>
				          		<div class="item-after address2">
				          			<div class="dizhi">
				          				<input type="text" id='city-picker' class="city" placeholder="请选择地址"/>
				          				<input type="text" class="fullAddress" placeholder="请输入详细地址"/>
				          			</div>
				          		</div>
				        	</div>
				     	</li>
				    </ul>
				</div>
				<!-- 保存按钮 -->
				<div id="sheBtn" class="row fixed_foort">
					<a href="javascript:void(0);" class="col-66 button button-fill addBtn">保存</a>
				</div>
         	</div>
     	</div>
    </div>
	<script src="{{ url_for('static',filename="app/js/zepto.js") }}"></script>
	<script src="{{ url_for('static',filename="app/js/sm.js") }}"></script>
	<script src="http://g.alicdn.com/msui/sm/0.6.2/js/sm-city-picker.min.js" charset="UTF-8"></script>
	<script>
		(function(){
			//判断是从哪个页面进入的，如果是设置页面那就可以设置号码和地址
			if(sessionStorage.getItem("whichPage") == "setup"){
				$(".page").eq(1).addClass('page-current').siblings().removeClass('page-current');
				sessionStorage.setItem("whichPage","");
			}else{
				$(".page").eq(0).addClass('page-current').siblings().removeClass('page-current');
			}

			// 电话号码
			var strTel = null,telFirst,telLast;//电话号码，号码的前三位，号码的后四位
			yourTel = "{{ perInfor1.yourTel }}";
			if(yourTel){
				// strTel = yourTel;
				telFirst = yourTel.slice(0,3);//号码的前三位
				telLast = yourTel.slice(7,11);//号码的最后四位
				$(".telphone1").html(telFirst + "****" + telLast)
				$(".telphone2 .inputTel").val(yourTel);
			}

			// 地址  省市区
			var addressCity = "{{ perInfor1.addressCity }}";
			console.log(addressCity)
			if(addressCity){
				// 将省市区变成数组形式
				var arrCity = addressCity.split(" ");
				$(".city").val(addressCity);
				// console.log(arrCity);
				// 省市区
				$("#city-picker").cityPicker({
				    toolbarTemplate: '<header class="bar bar-nav">\
				    <button class="button button-link pull-right close-picker">确定</button>\
				    <h1 class="title">选择地址</h1>\
				    </header>',
				    value:[arrCity[0],arrCity[1],arrCity[2]]
				});
			}else{
				// 省市区
				$("#city-picker").cityPicker({
				    toolbarTemplate: '<header class="bar bar-nav">\
				    <button class="button button-link pull-right close-picker">确定</button>\
				    <h1 class="title">选择地址</h1>\
				    </header>'
				});
			}

			// 详细地址
			var fullAddress = "{{ perInfor1.fullAddress }}";
			if(fullAddress){
				$(".fullAddress").val(fullAddress);
			}

			// 电话
			// 电话号码的正则
			var regTel = /^[1][358][0-9]{9}$/;
			// var telRe;
			// // 输入号码失去焦点
			$(".inputTel").blur(function(){
				$(".telphone2").parents(".item-content").removeClass('telActive');
			});
			
			// 输入号码聚焦
			$(".inputTel").focus(function(){
				$(".telphone2").parents(".item-content").addClass('telActive');
			})
			// 只能输入中文
			var reg = /^[0-9]*$/;
			$(".inputTel").on("input",function(){
				if(!reg.test($(this).val())){
					var len = $(this).val().length-1;
					while(!reg.test($(this).val().slice(0,len))){
							len--;
					}
					if(len <= 0){
						$(this).val("");
					}else {
						$(this).val($(this).val().slice(0,len));
					}
				}
				$(".telphone2").parents(".item-content").addClass('telActive');
			})
			$(".addBtn").click(function() {
				// 发送修改信息之后请求				
				if(regTel.test($(".inputTel").val())){
					$.showIndicator();
					$.ajax({
						url: '/testing_app1/personal',
						type: 'POST',
						data: "yourTel=" + $(".inputTel").val() + "&addressCity=" + $(".city").val() + "&fullAddress=" + $(".fullAddress").val(),
						success:function(){
							$.hideIndicator();
							location.reload();
						}
					})
				}else{
					$(".inputTel").focus();
				}
			});
		})();
	</script>
</body>
</html>